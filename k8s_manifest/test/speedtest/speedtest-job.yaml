apiVersion: batch/v1
kind: Job
metadata:
  name: speedtest
  namespace: test
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
      - name: speedtest
        image: curlimages/curl:latest
        imagePullPolicy: IfNotPresent
        command:
        - /bin/sh
        - -c
        - |
          echo "=== Network Speed Test ==="
          echo "Testing download speed with 10MB file..."
          START_TIME=$(date +%s.%3N)
          curl -s -o /dev/null -w "Download Speed: %{speed_download} bytes/sec (%{speed_download}/8 Mbps)\nTotal Time: %{time_total}s\nFile Size: %{size_download} bytes\n" http://speedtest.tele2.net/10MB.zip
          END_TIME=$(date +%s.%3N)
          DURATION=$(echo "$END_TIME - $START_TIME" | bc -l 2>/dev/null || echo "N/A")
          echo "Test Duration: ${DURATION}s"

          echo ""
          echo "=== Ping Test ==="
          echo "Testing latency to google.com..."
          ping -c 4 google.com | tail -1

          echo ""
          echo "=== DNS Resolution Test ==="
          echo "Resolving docker.io..."
          nslookup docker.io 2>/dev/null || echo "nslookup not available, trying getent..."
          getent hosts docker.io 2>/dev/null || echo "DNS resolution test completed"
