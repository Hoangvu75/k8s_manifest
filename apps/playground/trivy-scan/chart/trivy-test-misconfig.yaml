# Deployment cố ý có misconfig để test Trivy scan cluster.
# Trivy sẽ báo: chạy root, thiếu resource limits, thiếu securityContext...
# Sau khi test xong có thể xóa file này và bỏ khỏi kustomization.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: trivy-test-misconfig
  namespace: trivy-scan
  labels:
    app.kubernetes.io/name: trivy-scan
    app: trivy-test-misconfig
spec:
  replicas: 1
  selector:
    matchLabels:
      app: trivy-test-misconfig
  template:
    metadata:
      labels:
        app: trivy-test-misconfig
    spec:
      # Không có securityContext ở pod → Trivy báo
      containers:
        - name: nginx
          image: nginx:alpine
          # Chạy root, không có runAsNonRoot / runAsUser
          # Không có resources.limits/requests → KSV011, KSV012
          # Không có readOnlyRootFilesystem, allowPrivilegeEscalation...
          ports:
            - containerPort: 80
