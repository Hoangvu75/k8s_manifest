# Trivy K8s manifest scan service - Scan all playground apps, post to Discord
applicationName: trivy-scan

deployment:
  enabled: true
  replicas: 1
  image:
    repository: harbor.hoangvu75.space/library/trivy-scan
    tag: "fddf0af"
    pullPolicy: Always
  ports:
    - containerPort: 8080
      name: http
  envFrom:
    - type: secret
      name: trivy-scan-secret
  containerSecurityContext:
    runAsNonRoot: false
  env:
    PORT:
      value: "8080"
  livenessProbe:
    enabled: true
    httpGet:
      path: /health
      port: 8080
      scheme: HTTP
    initialDelaySeconds: 10
    periodSeconds: 10
  readinessProbe:
    enabled: true
    httpGet:
      path: /health
      port: 8080
      scheme: HTTP
    initialDelaySeconds: 5
    periodSeconds: 5
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  # Thư mục tạm để scan (clone repo, trivy) - tránh FileNotFoundError: No usable temporary directory
  volumes:
    tmp:
      emptyDir: {}
  volumeMounts:
    tmp:
      mountPath: /tmp

persistence:
  enabled: false

service:
  enabled: true
  ports:
    - port: 80
      targetPort: 8080
      name: http

ingress:
  enabled: false
